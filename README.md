CSE364 Group 4, Team Woongbae without Woongbae (TWwW)
===

---

# [Milestone 2] Readme

## 1. Recommendation Algorithm Design

<!-- TODO(1/3): 아래 ### N.M. 참고해서 수정하기 -->
### 1.1. Apple and Banana or Cheese Like Donuts (타이틀 대소문자 확인) 
`### 1.N`으로 `1. Recommendation Algorithm Design` 부분과 같이 분량이 많은 부분 나눠주기, 다른 부분은 짧아서 안해도 될듯
### 1.2. 대충 소개하는 서론
### 1.3. 대충 본격적인 본론
### 1.4. 대충 정리하는 결론
<!-- TODO(1/3) -->

Our team has implemented movie recommendation algorithm based on Alternating Least Square(ALS) algorithm via ALS library supported by [org.apache.spark.mllib](https://spark.apache.org/docs/latest/mllib-collaborative-filtering.html#collaborative-filtering) in [Spark](https://spark.apache.org/docs/latest/index.html).

In addition to this, we refined the recommendation result generated by the ALS prediction.  

Below is the pseudocode of the recommendation algorithm.  

1. Check if given input data files (ratings/user/movies.dat) are identical to the previously given files.

2. If files are identical, skip generating new model.

3. Generate prediction model with ALS algorithm. (rank = 10, iteration = 20, learning rate = 0.01)

4. Generate input for prediction.
    - User:
      - Filter user with given parameters. (e.g. F, Grad Student, etc.)
    - Movie:
      - Filter out movies with less than 10 total reviews from users in users.dat file.
      - Filter movie with given parameters. (e.g. Action|Comedy, etc.)

5. Generate estimated rating for the filtered movie list.
    - Assume filtered user list UF, number of filtered users A.
    - Assume filtered movie list MF, number or filtered movies B.
    - For all UF[i]:
      - Get estimated ratings for each movie in MF.
    - This takes O(AB) time, so we made an arbitrary upperbound U of (A * B).
      
      If (A * B) > U, then sort UF by the number of ratings a user left, and pick top (U / B) users.
      
      U == 2 * sqrt(`Total number or user == 6600`) * (`Total number of movies == 4000`), which is approximately 620,000.
    - We had to make an upperbound of filtered user with statistical reason.
      
      Below is a reason why 2*(sqrt(Total number or user == 6600)) == 162 works.
        - Population size: 6600 in the worst case (entire user set)
        - Sample size: 2*(sqrt(6600)) == 162
        - This is enough to support below specification in the worst case.
        - Confidence Level: 80%
        - Margin of Error: 5%


6. Sort and get top 10 movies.
    - Calculate average estimated rating for movies in MF.
    - Sort MF by the average estimated rating.
    - Pick top 10 from MF.

ALS is a way to implement Collaborative Filtering(CF), which is a method used to estimate a user's preference information based on preference information of other people.  
In this movie recommendation system, CF is used to estimate rating of a movie without a user's previous rating information on that specific movie.  

Original ALS algorithm was introduced by [Koren et al](https://dl.acm.org/doi/10.1109/MC.2009.263), and supported by Spark library.  

If a rank is set by `n`, number of users set by `U`, number of movies set by `M`, two data frames are made.  
First dataframe is for users, with `U x n` size. Second dataframe is for movies, with `n x M` size.  
Multiplying `U x n` matrix and `n x M` matrix makes a `U x M` size inference matrix.  

ALS reduces the loss between the inference matrix and the actual dataset by Stochastic Gradient Descent(SGD).  

We set the ranks as 10, number of iterations as 20, regularization parameter as 0.01.  

Our program automatically generate and check [checksum](https://en.wikipedia.org/wiki/Checksum) of input data files,  
and only generate new model only if the original input data has been changed.  

## 2. How to Use

Execute below command with proper parameters.

Our program treats `""` as *all*.

For example:
- `"F" "25" "" "Adventure"` will return Adventure genre movies for 25 years old female group, for all occupations.

- `"" "" ""` will return top 10 movies for all gender/age/occupation/genre.

- `"" "" "" ""` is the same as `"" "" ""`.

<!-- TODO(2/3): 대충 프로그램 실행하는데 작성할 전체 명령어라는 내용 + 메모리 설정 인수가 필요하다는 내용 -->
`java -Xms1g -Xmx4g -cp target/cse364-project-1.0-SNAPSHOT-allinone.jar kr.twww.mrs.Main "[M/F]" "[Age]" "[Occupation]" "[Genre(s)]"`
<!-- TODO(2/3) -->

## 3. Handling Errors

- For invalid occupations like "Wizard", error message is printed like below example.
    ```
    Error: Invalid gender character
    Error: Movie recommendation failed
    ```

- For invalid gender like "X", error message is printed like below example.
    ```
    Error: Invalid gender character
    Error: Movie recommendation failed
    ```

- For invalid genre like "Co", error message is printed like below example.
    ```
    Error: Invalid genre string
    Error: Movie recommendation failed
    ```

- If our program fails to generate a checksum for checking model data, error message is printed like below example.
    ```
    Error: Get checksum failed
    Error: Save checksum failed
    ```

- If our program fails to create prediction model, error message is printed like below example.
    ```
    Error: Create model failed
    Error: Load model failed
    ```
  
## 4. Example Output

<!-- TODO(3/3): 예시 출력(아웃풋 전부 ```로) + 대충 프로그램이 이런 유저에게 저런 영화를 추천해줬다는 내용 -->
<!-- TODO(3/3) -->

## 5. Roles of Each Member

- Kim Taeyeong
  * Made conceptual design of recommendation engine with ALS algorithm.
  * Implemented recommendation engine with ALS algorithm.
  * Implemented checksum routine for data files and model files.
  * Engaged in overall aspect of this project. 


- Jeon Woongbae: 
  * Made conceptual design of recommendation engine with ALS algorithm.
  * Implemented unit test PredictorImplTest.
  * FYI: Wrote this file!
    

- Park Sangbeen, An Jinmyeong:
  * Added new link.dat link parser.
  * Refactored and improved DataReader part previously made in Milestone 1, enhanced data parsing speed.

---

# [Milestone 1] Readme

#### 1. A short description of what this team finished for this milestone.
  We developed a program which
  - Receive user inputs, which are given a list of genres and an occupation.  
  - Extract the matching results from the rating.dat.   
  - Calculate the average rating score of the matching rating results.  

#### 2. A description of how to run this program. An example of java command line will be good.
  - ```java -cp ./target/cse364-project-1.0-SNAPSHOT-jar-with-dependencies.jar kr.twww.mrs.Main [Genre] [Occupation]```
  - example) ```java -cp ./target/cse364-project-1.0-SNAPSHOT-jar-with-dependencies.jar kr.twww.mrs.Main Adventure educator```

#### 3. Roles of each team member (i.e. who did what?)

- Kim Taeyeong
  * Enabled Docker setting, distributed the developing environment for the team.
  * *Project design*:
    - Designed and Milestone 1 project scheme, implemented primitive structure.
    - Categorized development tasks into 3 parts: *data parsing, data preprocessing, and unit test.*
  * *Project Manager*:
    - Divided and distributed the development role into 3 parts: data parsing, data preprocessing, and unit test.
    - Managed the development process, helped other 3 teammates when there is a development issue.
  
- Park Sangbeen:  
  * Developed `dataPreprocess` class. `dataPreprocess` class includes: `GetGenreList`, `GetOccupation`, `GetScoreList`
  * Preprocessed given 2 user inputs, genres and occupation. (`GetGenreList`,  `GetOccupationList`)
  * Implemented `GetScoreList`, which is to find all the matching rating result from given preprocessed dataset and given user input.

- An Jinmyeong: 
  * Developed `dataReader` class. `dataReader` class includes: `ReadTextFromFile`, `ToUserList`, `ToMovieList`, `ToRatingList`
  * Implemented string parser routine for `user.dat`, `ratings.dat`, `movies.dat`.
  * Implemented data process routine which makes a list of data from a parsed string. Converted raw `user/rating/movie.dat` into `ArrayList<User/Rating/Movie>`.

- Jeon Woongbae: 
  * Developed the entire JUnit unit tests by using [parametrized JUnit test](https://github.com/junit-team/junit4/wiki/Parameterized-tests).
  * Implemented JUnit test code, generated test cases for every method in `dataReader` and `dataPreprocess` class.
  * `dataReaderTest`: 5 tests (`dataReaderTest`: `GetPathTest`, `ReadTextFromFileTest`, `ToUserListTest`, `ToMovieListTest`, `ToRatingListTest`)
  * `dataPreprocesTest`: 5 tests (`GetGenreListTest`, `GetOccupationTest`, `GetScoreListTest`, `MovieFilterTest`, `UserFilterTest`)
  * FYI: Wrote this file!
